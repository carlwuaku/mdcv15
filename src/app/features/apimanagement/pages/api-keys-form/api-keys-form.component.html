<div *ngIf="!showSecretWarning">
  <mat-card>
    <mat-card-content>
      <app-form-generator [url]="formUrl" [fields]="fields" [existingObjectUrl]="existingUrl"
        (onSubmit)="formSubmitted($event)" [id]="id" [extraData]="extraFormData"
        [autoGenerateFields]="autoGenerateFields" [sendAsJson]="true">
      </app-form-generator>
    </mat-card-content>
  </mat-card>
</div>

<div *ngIf="showSecretWarning" class="max-w-4xl mx-auto mt-8">
  <mat-card class="border-4 border-red-500">
    <mat-card-header class="bg-red-50 p-4">
      <mat-icon class="text-red-600 mr-2">warning</mat-icon>
      <h2 class="text-xl font-bold text-red-600">IMPORTANT: Save Your API Credentials</h2>
    </mat-card-header>
    <mat-card-content class="p-6">
      <div class="mb-6">
        <p class="text-lg mb-4">
          Your API key has been successfully created. Please save the following credentials now.
          <strong class="text-red-600">They will never be shown again!</strong>
        </p>
      </div>

      <div class="mb-6 p-4 bg-gray-50 rounded">
        <h3 class="font-semibold mb-2">Key Secret:</h3>
        <div class="flex items-center gap-2">
          <code class="flex-1 p-2 bg-white border rounded font-mono text-sm break-all">{{ createdKeySecret }}</code>
          <button mat-icon-button (click)="copyToClipboard(createdKeySecret!)" matTooltip="Copy to clipboard">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </div>

      <div class="mb-6 p-4 bg-gray-50 rounded">
        <h3 class="font-semibold mb-2">HMAC Secret:</h3>
        <div class="flex items-center gap-2">
          <code class="flex-1 p-2 bg-white border rounded font-mono text-sm break-all">{{ createdHmacSecret }}</code>
          <button mat-icon-button (click)="copyToClipboard(createdHmacSecret!)" matTooltip="Copy to clipboard">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </div>

      <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
          <mat-icon class="text-yellow-600 mr-2">info</mat-icon>
          <div>
            <h4 class="font-semibold text-yellow-800">Security Notice</h4>
            <ul class="list-disc list-inside text-sm text-yellow-700 mt-2">
              <li>Store these credentials securely (e.g., in a password manager or secrets vault)</li>
              <li>Never commit these credentials to version control</li>
              <li>Use environment variables in your application</li>
              <li>If compromised, immediately revoke this key and generate a new one</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2">
        <button mat-raised-button color="primary" (click)="closeAndNavigate()">
          <mat-icon>check</mat-icon> I have saved the credentials
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
