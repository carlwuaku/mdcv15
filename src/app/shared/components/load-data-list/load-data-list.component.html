<div class="flex-col gap4">

  <app-pagination [current_page]="currentPage" [total]="totalRows" [limit]="limit" (pageChanged)="setPage($event)"
    (limitChanged)="setLimit($event)"></app-pagination>


  <div class="mini-card">
    <em>{{selection.selected.length}} Selected:</em>
    <app-export-table [objects]="selection.selected"></app-export-table>
    <button (click)="getData()" mat-stroked-button color="primary"><mat-icon>refresh</mat-icon> Reload </button>

  </div>
  <app-loading *ngIf="loading"></app-loading>
  <div>
    <form ngNativeValidate (ngSubmit)="search()">
      <label for="">Search</label> <input name="search" required matInput [(ngModel)]="searchParam" type="search">
      <button type="submit" mat-raised-button color="primary"> <mat-icon>search</mat-icon> Search</button>

    </form>
  </div>
  <div class="alert alert-info" role="alert">
    Click on a column header to sort the table. <br>
    To export the data, e.g. to excel format, select the rows you would like to export. Use the top checkbox to select all
  </div>

  <div class="table-responsive">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
     <ng-container *ngFor="let column of displayedColumns" matColumnDef="{{column}}">

          <span [ngSwitch]="column">
            <span *ngSwitchCase="'select'">
              <th mat-header-cell *matHeaderCellDef >
              <mat-checkbox (change)="$event ? toggleAllRows() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
              </mat-checkbox>
              </th>
            </span>
            <span *ngSwitchCase="'#'"><th mat-header-cell *matHeaderCellDef >#</th> </span>
            <span *ngSwitchCase="'actions'"><th mat-header-cell *matHeaderCellDef >Actions</th> </span>
            <span *ngSwitchDefault>
              <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{getColumnLabel(column)}}
              </th>
            </span>


          </span>


        <td mat-cell *matCellDef="let element; let i = index;">
          <span [ngSwitch]="column">
            <span *ngSwitchCase="'#'">{{i + 1}}</span>

            <span *ngSwitchCase="'actions'">
              <button mat-raised-button color="primary" [matMenuTriggerFor]="menu"
                aria-label="Example icon-button with a menu">
                <mat-icon>expand_more</mat-icon> Menu
              </button>
              <mat-menu #menu="matMenu">
                <ng-container *ngFor="let action of element.actions">
                  <ng-container [ngTemplateOutlet]="action.type === 'button' ? buttonTemplate : linkTemplate"
                    [ngTemplateOutletContext]="{ action: action }">
                  </ng-container>
                </ng-container>
              </mat-menu>

              <ng-template #buttonTemplate let-action="action">
                <button (click)="action.onClick(element)" mat-menu-item>
                  <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
                  <span>{{ action.label }}</span>
                </button>
              </ng-template>

              <ng-template #linkTemplate let-action="action">
                <a routerLink="/{{action.link}}/{{element[action.linkProp]}}" mat-menu-item>
                  <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
                  <span>{{ action.label }}</span>
                </a>
              </ng-template>
            </span>

            <span *ngSwitchCase="'select'">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(element) : null"
                [checked]="selection.isSelected(element)" [aria-label]="checkboxLabel(element)">
              </mat-checkbox>
            </span>

            <span *ngSwitchDefault>
              {{element[column]}}
            </span>
          </span>

        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </div>
</div>
